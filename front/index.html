<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sign up / Login Form</title>
    <link rel="stylesheet" href="./style.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" type="text/css" href="slide-navbar-style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="icon">
      <img id="icon" src="images.png" />
    </div>
    <div class="main">
      <input type="checkbox" id="chk" aria-hidden="true" />

      <div class="signup">
        <form>
          <label for="chk" aria-hidden="true">Sign up</label>
          <input type="text" name="txt" placeholder="Username" required="" />
          <input type="email" name="email" placeholder="Email" required="" />
          <input
            type="password"
            name="pswd"
            placeholder="Password"
            required=""
          />
          <button onclick="login()">Sign up</button>
        </form>
      </div>

      <div class="login">
        <form onsubmit="login()">
          <label for="chk" aria-hidden="true">Login</label>
          <input type="email" name="email" placeholder="Email" required="" />
          <input
            type="password"
            name="pswd"
            placeholder="Password"
            required=""
          />
          <button type="submit">Login</button>
        </form>
      </div>
    </div>

    <script>
      function login(event) {
        event.preventDefault(); // Предотвратить стандартное поведение формы
    
        const username = document.querySelector('input[name="username"]').value;
        const password = document.querySelector('input[name="password"]').value;
        const url = 'https://we-hack-production.up.railway.app/token'; // Замените URL на ваш API endpoint
        
        axios.post(url, `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`, {
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          }
        })
        .then(function (response) {
          console.log('Authentication successful:', response.data);
          localStorage.setItem('token', response.data.access_token); // Сохраняем токен в localStorage
          alert('You are now logged in.');
          // Здесь можно добавить перенаправление на другую страницу
          window.location.href = 'schelude.html'; // Например, перенаправить на домашнюю страницу
        })
        .catch(function (error) {
          console.error('Authentication error:', error);
          alert('Authentication failed: ' + error.response.data.detail); // Показываем сообщение об ошибке, если оно есть
        });
      }
      function signUp() {
        const username = document.querySelector('input[name="txt"]').value;
        const email = document.querySelector('input[name="email"]').value;
        const password = document.querySelector('input[name="pswd"]').value;
      
        axios.post("https://we-hack-production.up.railway.app/register/", {
          username: username,
          email: email,
          password: password
        }, {
          headers: {
            "Content-Type": "application/json",
          }
        })
        .then(response => {
          console.log("Registration Successful:", response.data);
        })
        .catch(error => {
          console.error("Error:", error);
          alert("Registration failed: " + error.message);
        });
      }
      </script>
      
  </body>
</html>
